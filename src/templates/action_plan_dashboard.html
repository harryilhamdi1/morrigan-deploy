<!-- ACTION PLAN DASHBOARD WRAPPER -->
<div class="main-content">

    <!-- 1. NATIONAL TAB -->
    <div id="tab-dashboard" class="fade-in">
        <!-- National Dashboard Hero -->
        <div class="rounded-4 p-4 mb-4 text-white position-relative shadow-sm overflow-hidden"
            style="background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);">
            <!-- Decorative background element -->
            <div
                style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(59,130,246,0.3) 0%, rgba(0,0,0,0) 70%); border-radius: 50%;">
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center position-relative"
                style="z-index: 2;">
                <div>
                    <h2 class="fw-bold mb-1" style="font-family: 'Outfit', sans-serif; letter-spacing: -0.5px;">National
                        Implementation Status</h2>
                    <p class="text-white-50 mb-0"><i class="bi bi-info-circle me-1"></i>Overview of store action plan
                        execution across Indonesia.</p>
                </div>
                <div class="text-end mt-3 mt-md-0">
                    <div class="small fw-bold text-white-50 text-uppercase" style="letter-spacing: 1px;">Data Updated
                    </div>
                    <div class="badge bg-white bg-opacity-25 text-white border border-light px-3 py-1 rounded-pill fw-bold shadow-sm backdrop-blur"
                        id="nationalLastUpdated" style="font-size: 0.85rem;"><i
                            class="bi bi-clock-history me-1"></i>Just Now</div>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-premium hover-lift border-0 shadow-sm accent-stripe-blue">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted small fw-bold text-uppercase">Total Plans</div>
                        <div class="kpi-icon bg-primary bg-opacity-10 text-primary">
                            <i class="bi bi-card-checklist fs-4"></i>
                        </div>
                    </div>
                    <div class="metric-big text-dark" id="natTotalPlans">0</div>
                    <div class="small text-muted mt-2"><i class="bi bi-graph-up-arrow text-success me-1"></i>Generated
                        by AI</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-premium hover-lift border-0 shadow-sm accent-stripe-success">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted small fw-bold text-uppercase">Completed</div>
                        <div class="kpi-icon bg-success bg-opacity-10 text-success">
                            <i class="bi bi-check-circle-fill fs-4"></i>
                        </div>
                    </div>
                    <div class="metric-big text-success" id="natCompleted">0</div>
                    <div class="small text-muted mt-2">Fully Verified by HCBP</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-premium hover-lift border-0 shadow-sm accent-stripe-warning">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted small fw-bold text-uppercase">In Progress</div>
                        <div class="kpi-icon bg-warning bg-opacity-10 text-warning">
                            <i class="bi bi-arrow-repeat fs-4"></i>
                        </div>
                    </div>
                    <div class="metric-big text-warning" id="natInProgress">0</div>
                    <div class="small text-muted mt-2">Awaiting Management Review</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-premium hover-lift border-0 shadow-sm accent-stripe-danger">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted small fw-bold text-uppercase">Pending</div>
                        <div class="kpi-icon bg-danger bg-opacity-10 text-danger">
                            <i class="bi bi-hourglass-top fs-4"></i>
                        </div>
                    </div>
                    <div class="metric-big text-danger" id="natPending">0</div>
                    <div class="small text-muted mt-2">Needs Store Execution</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. REGIONAL TAB -->
    <div id="tab-regional" class="fade-in" style="display:none;">
        <div class="d-flex align-items-center gap-3 mb-4">
            <div class="bg-primary bg-opacity-10 p-3 rounded-4">
                <i class="bi bi-map-fill text-primary fs-3"></i>
            </div>
            <div>
                <h2 class="fw-bold mb-1"
                    style="font-family: 'Outfit', sans-serif; letter-spacing: -0.5px; color: var(--primary);">Regional
                    Implementation Detail
                </h2>
                <p class="text-muted mb-0">Action plan execution progress aggregated across Regions.</p>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm overflow-hidden" style="border-radius: 16px;">
                    <div class="table-responsive px-1 pb-2">
                        <table class="table premium-table align-middle mb-0" id="apRegionalTable">
                            <thead>
                                <tr class="text-secondary small text-uppercase"
                                    style="font-size: 0.7rem; letter-spacing: 0.5px; font-weight: 700;">
                                    <th class="py-3 ps-4" style="width: 30%;">Region</th>
                                    <th class="py-3 text-center">Total Stores</th>
                                    <th class="py-3 text-center">Action Plans Generated</th>
                                    <th class="py-3 text-center">Implementation Rate</th>
                                </tr>
                            </thead>
                            <tbody class="border-top-0" id="apRegionalBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. BRANCH TAB -->
    <div id="tab-branch" class="fade-in" style="display:none;">
        <div class="d-flex align-items-center gap-3 mb-4">
            <div class="bg-warning bg-opacity-10 p-3 rounded-4">
                <i class="bi bi-diagram-3-fill text-warning fs-3"></i>
            </div>
            <div>
                <h2 class="fw-bold mb-1"
                    style="font-family: 'Outfit', sans-serif; letter-spacing: -0.5px; color: var(--primary);">Branch
                    Implementation Detail
                </h2>
                <p class="text-muted mb-0">Action plan execution progress aggregated across Branches.</p>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm overflow-hidden" style="border-radius: 16px;">
                    <div class="table-responsive px-1 pb-2">
                        <table class="table premium-table align-middle mb-0" id="apBranchTable">
                            <thead>
                                <tr class="text-secondary small text-uppercase"
                                    style="font-size: 0.7rem; letter-spacing: 0.5px; font-weight: 700;">
                                    <th class="py-3 ps-4" style="width: 30%;">Branch</th>
                                    <th class="py-3" style="width: 20%;">Region</th>
                                    <th class="py-3 text-center">Total Stores</th>
                                    <th class="py-3 text-center">Implementation Rate</th>
                                </tr>
                            </thead>
                            <tbody class="border-top-0" id="apBranchBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. STORE MONITORING TAB (FLAGSHIP FEATURE) -->
    <div id="tab-stores" class="fade-in" style="display:none;">

        <!-- STORE MASTER LIST -->
        <div id="storeListContainer" class="fade-in">
            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="bg-success bg-opacity-10 p-3 rounded-4">
                        <i class="bi bi-shop-window text-success fs-3"></i>
                    </div>
                    <div>
                        <h2 class="fw-bold mb-1"
                            style="font-family: 'Outfit', sans-serif; letter-spacing: -0.5px; color: var(--primary);">
                            Store
                            Action Plan Execution
                        </h2>
                        <p class="text-muted mb-0">Select a store to monitor, approve, and comment on their improvement
                            tasks.</p>
                    </div>
                </div>

                <!-- Search Box -->
                <div class="position-relative" style="width: 100%; max-width: 350px;">
                    <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                    <input type="text" class="form-control rounded-pill ps-5 py-2 bg-white shadow-sm border-0"
                        placeholder="Search store, region, or branch..."
                        oninput="renderActionPlanStoreTable(this.value)">
                </div>
            </div>

            <div class="card border-0 shadow-sm overflow-hidden bg-transparent">
                <div class="table-responsive px-1 pb-2">
                    <table class="table premium-table align-middle mb-0" id="apStoreMasterTable">
                        <thead>
                            <tr class="text-secondary small text-uppercase"
                                style="font-size: 0.7rem; letter-spacing: 0.5px; font-weight: 700;">
                                <th class="py-2 ps-4" style="width: 40%;">Store Profile</th>
                                <th class="py-2" style="width: 25%;">Location</th>
                                <th class="py-2 text-center" style="width: 20%;">Implementation Rate</th>
                                <th class="py-2 text-center pe-4" style="width: 15%;">Action</th>
                            </tr>
                        </thead>
                        <tbody class="border-top-0" id="apStoreMasterBody" style="background:transparent;">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- STORE DETAIL VIEW -->
        <div id="storeContent" style="display:none;" class="fade-in">
            <!-- Hero Header -->
            <div class="rounded-4 p-4 mb-4 text-white position-relative shadow-sm overflow-hidden"
                style="background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);">
                <!-- Decorative background element -->
                <div
                    style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(16,185,129,0.2) 0%, rgba(0,0,0,0) 70%); border-radius: 50%;">
                </div>

                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start position-relative"
                    style="z-index: 2;">
                    <div>
                        <button class="btn btn-dark btn-sm rounded-pill px-3 mb-3 border-light border-opacity-25"
                            style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);"
                            onclick="showStoreList()"><i class="bi bi-arrow-left me-2"></i>Back to Store List</button>
                        <div class="d-flex align-items-center gap-3 mb-1">
                            <div class="bg-white bg-opacity-25 p-2 rounded-3 text-white backdrop-blur shadow-sm d-flex align-items-center justify-content-center"
                                style="width: 48px; height: 48px;">
                                <i class="bi bi-shop fs-4"></i>
                            </div>
                            <h2 class="fw-bold mb-0" id="apStoreName"
                                style="font-family: 'Outfit', sans-serif; letter-spacing: -0.5px; font-size: 2rem;">
                                Store Name</h2>
                        </div>
                        <div class="opacity-75 small text-uppercase fw-bold ms-5 ps-2" id="apStoreMeta"
                            style="letter-spacing:1px;"><i class="bi bi-geo-alt me-1"></i>REGION â€¢ BRANCH</div>
                    </div>
                    <div class="text-end mt-3 mt-md-0">
                        <div class="small fw-bold text-white-50 text-uppercase mb-1" style="letter-spacing: 1px;">
                            Implementation
                            Rate</div>
                        <div class="display-5 fw-bold text-success text-shadow-sm" id="apStoreCompletion"
                            style="font-family: 'Outfit', sans-serif;">0%</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="row g-4 mb-4">
                <!-- Left: Action Plan Checklist -->
                <div class="col-lg-8 d-flex flex-column gap-3" id="apTaskListContainer">
                    <!-- Tasks injected by JS -->
                </div>

                <!-- Right: Tracking Calendar / Timeline -->
                <div class="col-lg-4">
                    <div class="card border-0 shadow-sm sticky-top" style="top: 20px;">
                        <div class="card-header bg-white border-bottom py-3">
                            <h6 class="fw-bold text-dark mb-0"><i
                                    class="bi bi-calendar2-week-fill text-primary me-2"></i>Weekly Tracking Calendar
                            </h6>
                        </div>
                        <div class="card-body p-4 bg-light">
                            <ul class="list-group list-group-flush bg-transparent" id="apWeeklyTimeline"
                                style="position: relative;">
                                <!-- Timeline injected by JS -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>