!function(e,t){var i=0;e.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,maxSelected:!1,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{}},_create:function(){var t=this.element.hide(),i=this.options;this.speed=e.fx.speeds._default,this._isOpen=!1;var s=(this.button=e('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(i.classes).attr({title:t.attr("title"),"aria-haspopup":!0,tabIndex:t.attr("tabIndex")}).insertAfter(t),l=((this.buttonlabel=e("<span />")).html(i.noneSelectedText).appendTo(s),(this.menu=e("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(i.classes).appendTo(document.body)),n=(this.header=e("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(l);(this.headerLinkContainer=e("<ul />")).addClass("ui-helper-reset").html(function(){return!0===i.header?"<li>"+(0==i.maxSelected?'<a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+i.checkAllText+"</span></a>":"")+'</li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+i.uncheckAllText+"</span></a></li>":"string"==typeof i.header?"<li>"+i.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(n),(this.checkboxContainer=e("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(l);this._bindEvents(),this.refresh(!0),i.multiple||l.addClass("ui-multiselect-single")},_init:function(){!1===this.options.header&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(t){var s=this.element,l=this.options,n=this.menu,a=this.checkboxContainer,c=[],h="",o=s.attr("id")||i++;s.find("option").each(function(t){e(this);var i,s=this.parentNode,n=this.innerHTML,a=this.title,u=this.value,d="ui-multiselect-"+(this.id||o+"-option-"+t),r=this.disabled,p=this.selected,m=["ui-corner-all"],g=(r?"ui-multiselect-disabled ":" ")+this.className;"OPTGROUP"===s.tagName&&(i=s.getAttribute("label"),-1===e.inArray(i,c)&&(h+='<li class="ui-multiselect-optgroup-label '+s.className+'"><a href="#">'+i+"</a></li>",c.push(i))),r&&m.push("ui-state-disabled"),p&&!l.multiple&&m.push("ui-state-active"),h+='<li class="'+g+'">',h+='<label for="'+d+'" title="'+a+'" class="'+m.join(" ")+'">',h+="<input "+(l.multiple?"":'style="width:0px; "')+' id="'+d+'" name="multiselect_'+o+'" type="'+(l.multiple?"checkbox":"radio")+'" value="'+u+'" title="'+n+'"',p&&(h+=' checked="checked"',h+=' aria-selected="true"'),r&&(h+=' disabled="disabled"',h+=' aria-disabled="true"'),h+=" /><span>"+n+"</span></label></li>"}),a.html(h),this.labels=n.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this._setMenuWidth(),this.button[0].defaultValue=this.update(),t||this._trigger("refresh")},update:function(){var t,i=this.options,s=this.inputs,l=s.filter(":checked"),n=l.length;return t=0===n?i.noneSelectedText:e.isFunction(i.selectedText)?i.selectedText.call(this,n,s.length,l.get()):/\d/.test(i.selectedList)&&i.selectedList>0&&n<=i.selectedList?l.map(function(){return e(this).next().html()}).get().join(", "):i.selectedText.replace("#",n).replace("#",s.length),this.buttonlabel.html(t),t},_bindEvents:function(){var t=this,i=this.button;function s(){return t[t._isOpen?"close":"open"](),!1}if(i.find("span").bind("click.multiselect",s),i.bind({click:s,keypress:function(e){switch(e.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}},mouseenter:function(){i.hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},mouseleave:function(){e(this).removeClass("ui-state-hover")},focus:function(){i.hasClass("ui-state-disabled")||e(this).addClass("ui-state-focus")},blur:function(){e(this).removeClass("ui-state-focus")}}),this.header.delegate("a","click.multiselect",function(i){e(this).hasClass("ui-multiselect-close")?t.close():t[e(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),i.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(i){i.preventDefault();var s=e(this),l=s.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),n=l.get(),a=s.parent().text();!1!==t._trigger("beforeoptgrouptoggle",i,{inputs:n,label:a})&&(t._toggleChecked(l.filter(":checked").length!==l.length,l),t._trigger("optgrouptoggle",i,{inputs:n,label:a,checked:n[0].checked}))}).delegate("label","mouseenter.multiselect",function(){e(this).hasClass("ui-state-disabled")||(t.labels.removeClass("ui-state-hover"),e(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(i){switch(i.preventDefault(),i.which){case 9:case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(i.which,this);break;case 13:e(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(i){var s=e(this),l=this.value,n=this.checked,a=t.element.find("option");this.disabled||!1===t._trigger("click",i,{value:l,text:this.title,checked:n})?i.preventDefault():(s.focus(),s.attr("aria-selected",n),a.each(function(){this.value===l?this.selected=n:t.options.multiple||(this.selected=!1)}),t.options.multiple||(t.labels.removeClass("ui-state-active"),s.closest("label").toggleClass("ui-state-active",n),t.close()),setTimeout(e.proxy(t.update,t),10))}),e(document).bind("mousedown.multiselect",function(i){!t._isOpen||e.contains(t.menu[0],i.target)||e.contains(t.button[0],i.target)||i.target===t.button[0]||t.close()}),e(this.element[0].form).bind("reset.multiselect",function(){setTimeout(e.proxy(t.refresh,t),10)}),t.options.multiple&&0!=t.options.maxSelected){var l=this.menu;l.delegate('input[type="checkbox"]',"click",function(){console.log(l),e('input[type="checkbox"]:checked',l).length>=t.options.maxSelected?e('input[type="checkbox"]:not(:checked)',l).prop("disabled",!0):e('input[type="checkbox"]:not(:checked)',l).prop("disabled",!1)})}},_setButtonWidth:function(){var e=this.element.outerWidth(),t=this.options;/\d/.test(t.minWidth)&&e<t.minWidth&&(e=t.minWidth),this.button.width(e)},_setMenuWidth:function(){var e=this.menu,t=this.button.outerWidth()-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10)-parseInt(e.css("border-right-width"),10)-parseInt(e.css("border-left-width"),10);e.width(t||this.button.outerWidth())},_traverse:function(t,i){var s=38===t||37===t,l=e(i).parent()[s?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[s?"last":"first"]();if(l.length)l.find("label").trigger("mouseover");else{var n=this.menu.find("ul").last();this.menu.find("label")[s?"last":"first"]().trigger("mouseover"),n.scrollTop(s?n.height():0)}},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,i){var s=i&&i.length?i:this.inputs,l=this;if(1==t&&l.options.multiple&&0!=l.options.maxSelected){let i=e('input[type="checkbox"]:checked',this.menu).length;s.each(function(){if(i>=l.options.maxSelected)return!1;e(this).prop("checked")&&i++,this._toggleState("checked",t)})}else s.each(this._toggleState("checked",t));s.eq(0).focus(),this.update();var n=s.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&e.inArray(this.value,n)>-1&&l._toggleState("selected",t).call(this)})},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("ui-state-disabled");var i=this.menu.find("input"),s="ech-multiselect-disabled";(i=t?i.filter(":enabled").data(s,!0):i.filter(function(){return!0===e.data(this,s)}).removeData(s)).attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:t,"aria-disabled":t})},open:function(t){var i=this.button,s=this.menu,l=this.speed,n=this.options,a=[];if(!1!==this._trigger("beforeopen")&&!i.hasClass("ui-state-disabled")&&!this._isOpen){var c=s.find("ul").last(),h=n.show,o=i.offset();e.isArray(n.show)&&(h=n.show[0],l=n.show[1]||this.speed),h&&(a=[h,l]),c.scrollTop(0).height(n.height),s.css({top:o.top+i.outerHeight(),left:o.left}),e.fn.show.apply(s,a),this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),i.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var t=this.options,i=t.hide,s=this.speed,l=[];e.isArray(t.hide)&&(i=t.hide[0],s=t.hide[1]||this.speed),i&&(l=[i,s]),e.fn.hide.apply(this.menu,l),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close"),e(this.element).change()}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(e){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(t,i){var s=this.menu;switch(t){case"header":s.find("div.ui-multiselect-header")[i?"show":"hide"]();break;case"checkAllText":s.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":s.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":s.find("ul").last().height(parseInt(i,10));break;case"minWidth":this.options[t]=parseInt(i,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=i,this.update();break;case"classes":s.add(this.button).removeClass(this.options.classes).addClass(i);break;case"multiple":s.toggleClass("ui-multiselect-single",!i),this.options.multiple=i,this.element[0].multiple=i,this.refresh()}e.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);